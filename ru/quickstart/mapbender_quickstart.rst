:Author: OSGeo-Live
:Author: Astrid Emde
:Author: Christoph Baudson
:Author: Arnulf Christl
:Version: osgeo-live5.0draft
:License: Creative Commons Attribution-ShareAlike 3.0 Unported  (CC BY-SA 3.0)
:Thanks: mapbender-user list

.. image:: /images/project_logos/logo-Mapbender.png
  :scale: 100 %
  :alt: Логотип
  :align: right

********************************************************************************
Начало работы с Mapbender 
********************************************************************************

Mapbender — веб-ориентированный набор инструментов для разработки геопорталов, который позволяет публиковать, регистрировать, показывать пространственные данные, управлять ими, а также отслеживать и настраивать доступ к инфраструктурным пространственным сервисам. 

Интерфейсы управления позволяют администраторам поддерживать и категоризировать карты и сервисы пространственных данных, а также предоставлять доступ пользователям, группам и другим сервисам.

Для начала работы вам не потребуется ничего, кроме стандартного веб-браузера.

Быстрый старт включает:

  * запуск Mapbender;
  * создание приложения;
  * загрузка WMS (OGC WMS);
  * настройка WMS;
  * создание отдельных приложений;
  * создание пользователей и групп и назначение им приложений;
  * загрузка WFS;
  * функция настройки и создания приложений с поддержкой WFS, в которых можно выполнять поиск и редактирование.

Запуск Mapbender
================================================================================

.. TBD: Add menu graphic to this uDig Quickstart

#. Выберите  :menuselection:`Mapbender` из стартового меню

#. Приложению необходимо несколько минут для запуска

Если у вас возникнут какие либо сложности с запуском Mapbender, пожалуйста, проверьте что, веб-сервер Apache и БД PostgreSQL запущены.

Приветственная страница
================================================================================

#. Прежде чем вы сможете работать с Mapbender, вы должны осуществить вход, чтобы получить доступ к приложениям.

#. Приветственная страница предоставляет ссылки на наиболее важные страницы Mapbender. 

#. Вы можете войти как пользователь :guilabel:`root` с паролем :guilabel:`root` (Это пользователь по-умолчанию со стандартным паролем, установленный после развёртывания Mapbender. Пожалуйста, измените пароль пользователя *root*, если вы хотите использовать установленное приложение в реальной работе. Пожалуйста, не удаляйте пользователя :guilabel:`root`, т.к. этот пользователь имеет доступ к шаблонным приложениям Mapbender и используется для обновления).
  
  .. image:: /images/screenshots/800x600/mapbender_welcome.png
     :scale: 80

После успешного входа вы будете направлены на :guilabel:`application overview`.


Описание приложения
================================================================================
После входа вы будете перенаправлены на страницу :guilabel:`application overview` со списком приложений к которым вы имеете доступ. В Mapbender имеются шаблонные приложения, которые вы можете использовать для настройки ваших собственных приложений.

  .. image:: /images/screenshots/800x600/mapbender_application_overview.png
     :scale: 80

Mapbender предоставляет:
   * административные приложения
   * картографические приложения
   * приложения-контейнеры

Список приложений представлен на странице :guilabel:`categories`. Позже вы можете определить свои собственные категории и добавить приложения в необходимую категорию.


Управление приложением
================================================================================

:guilabel:`Administration applications` позволяют вам загружать сервисы, создавать пользователей, настраивать новые приложения. 

Каждое административное приложение (:guilabel:`administration application`) предоставляет различную функциональность. Позже вы можете установить свои административные приложения (:guilabel:`administration applications`) с необходимой вам функциональностью.

После установки пользователь :guilabel:`root` имеет доступ к:
   * разделам "ADMINISTRATION", "ADMINISTRATION_DE - WMS", "WFS", "application", "user/group handling" (новое в версии 2.7)
   * разделам "admin2_en - WMS", "application", "user/group handling"
   * разделу "admin_en_services" - сфокусирован на WFS и поддержке метаданных и owsproxy    
   * разделу "admin1" — шаблон ко всем административным элементам
   * разделам "admin_wms_metadata", "admin_wfs_metadata", "admin_wmc_metadata" - управление метаданными 

На картинке ниже представлен раздел *admin2_en*. С левой стороны вы можете видеть меню с перечнем возможностей, которые предлагает приложение.

  .. image:: /images/screenshots/800x600/mapbender_admin2_en.png
     :scale: 80

.. tip:: Вы можете вернуться к окну описания приложений при помощи кнопки |HOME|.

  .. |HOME| image:: /images/screenshots/800x600/mapbender_home.png
     :scale: 100

Картографическое приложение
================================================================================
Картографическое приложение включает OGC WMS, одну или несколько карт, кнопки, проводник пространственных данных, элемент легенды, ваш логотип и многое другое. 

#. Выберите картографическое приложение :guilabel:`by click` из :guilabel:`application overview`

#. Попробуйте функциональность, предоставляемую приложением:
   
   * например, выберите gui, gui_digitize
     
  .. image:: /images/screenshots/800x600/mapbender_gui_digitize.png
     :scale: 80

.. tip:: Если ваш браузер поддерживает вкладки, вы можете открыть приложения во вкладках и легко переключаться между ними.

Приложение контейнер WMS
================================================================================
Вы можете создавать приложение контейнер для размещения вашего WMS. Контейнер WMS не показывается. При помощи контейнеров вы можете создавать сложные репозитории сервисов.

  .. image:: /images/screenshots/800x600/mapbender_container.png
     :scale: 60

Создание собственного приложения
================================================================================

#. Перейдите в административное приложение :menuselection:`admin2_en` 

#. Выберите :menuselection:`Application Management --> Create new application`

#. Назначьте имя и описание для вашего приложения и выберите кнопку **new** чтобы создать приложение

#. Перейдите по ссылке :menuselection:`Application Management --> Edit application elements` и выберите новое приложение

#. В списке в верхней части окна выберите приложение, которое вы хотели бы взять в качестве шаблона, и нажмите на кнопку **add all elements**. Этот процесс перенесёт все элементы из выбранного приложения в ваше новое приложение.

#. Также вы можете взять отдельный элемент из другого приложения для вашего нового приложения. Выберите отдельный элемент активируя переключатель на элементе и нажмите кнопку **save**, чтобы сохранить этот элемент в вашем приложении.

#. Ваше приложение настроено. Теперь вам нужен WMS для отображения в приложении. Более подробно смотрите раздел **WMS Management** этой справки.


Копирование и переименование приложения
================================================================================
Вы также можете создать новое приложение копированием существующего. Перейдите к :menuselection:`Application Management --> Rename/copy application`, выберите приложение, которое вы хотите скопировать и определите имя нового приложения. Эта функция не только копирует приложение, она также копирует сервисы приложений и пользователей/группы (по желанию). Это означает, что у нового приложения уже есть картографический сервис, а также, если пользователи и группы имели доступ к исходному приложению, то они будут иметь доступ и к новому приложению.

Удаление приложения
================================================================================
Вы можете удалить приложение при помощи :menuselection:`Application Management --> Delete application`. Удаляется только приложение, а не сервисы, которые входили в его состав.
Вы не можете удалить приложения, которые также принадлежат другим пользователям.

Экспорт приложения
================================================================================
Вы можете экспортировать приложение при помощи языка SQL и :menuselection:`Application Management --> Export application (SQL)`. SQL-команды содержат все определения для элементов приложения и могут быть импортированы в другую инсталляцию Mapbender. 

.. tip:: Экспортированное приложение не включает информацию о сервисах, информацию о правах пользователей и групп.

********************************************************************************
Управление WMS
********************************************************************************

Загрузка WMS
================================================================================
Вы можете загрузить WMS-сервисы в ваше приложение.

WMS возвращает XML-файл при запросе **getCapabilities**. Mapbender разбирает результаты запроса и получает всю необходимую информацию о сервисах из файла XML.

.. tip:: Прежде чем загружать XML-файл, рекомендуется посмотреть его корректность в окне браузера.


#. Перейдите в раздел :guilabel:`admin2_en` и выберите :menuselection:`WMS Management --> Load WMS`. Выберите приложение которое должно содержать WMS. Укажите ссылку на WMS getCapabilities URL в поле ввода и нажмите **Load**.

#. Ниже приведены несколько примеров WMS которые вы можете загрузить в ваше приложение:

Кадастр Испании

http://ovc.catastro.meh.es/Cartografia/WMS/ServidorWMS.aspx?VERSION=1.1.1&REQUEST=GetCapabilities&SERVICE=WMS

Геопортал Барселоны (Geoportalbcn — ссылка на репозиторий сервисов)

http://www.bcn.cat/geoportal/es/geoserveis.html


Демо (Germany workshop demo)

http://wms.wheregroup.com/cgi-bin/germany_workshop.xml?VERSION=1.1.1&REQUEST=GetCapabilities&SERVICE=WMS
 

WhereGroup OSM WMS 

http://osm.wheregroup.com/cgi-bin/osm_basic.xml?REQUEST=GetCapabilities&SERVICE=WMS&VERSION=1.1.1
 
.. image::/images/screenshots/800x600/mapbender_admin2_en.png
  :scale: 80

Вы можете загрузить более одного WMS в приложение. Выберите *WMS application settings* для изменения порядка следования WMS или удаления WMS из вашего приложения.

WMS с индексом *0* определяет систему координат и охват карты по умолчанию.

.. tip:: Создайте приложение-контейнер и загрузите любой WMS, только один в этот контейнер. Вы можете передать WMS из контейнера в другие приложения. Когда вы обновляете WMS, возможные изменения могут появиться во всех приложениях, которые содержат этот WMS. Вы легко можете скопировать WMS из одного приложения в другое при помощи пункта меню *Link WMS to application*.
	

Настройка WMS
================================================================================
После загрузки WMS вы можете настроить WMS в соответствии со спецификой вашего приложения. Возможно, вам не нужно предоставлять все слои, или вы хотите изменить порядок заголовков слоёв, или отключить инструмент идентификации, или изменить максимальный масштаб слоя.

.. image:: /images/screenshots/800x600/mapbender_wms_application_settings.png
  :scale: 80

* on/off — активирует/деактивирует слой для отдельного приложения
* sel — разрешает выбор в проводнике пространственных данных
* sel_default — слой активируется при запуске приложения
* info / info default — слой предоставляет возможность запрашивать атрибуты, info default активирует возможность запроса атрибутов для геометрии
* minscale / maxscale — диапазон масштабов в которых показывается слой (если установлены в 0, то ограничения по масштабу отсутствуют)
* style — если WMS предоставляет более одного стиля, вы можете выбрать другой стиль вместо стиля по-умолчанию
* prio — определяет порядок отрисовки слоев
* setWFS — соединяет слой WMS с конфигурацией WFS (подробнее об этом будет сказано далее)

********************************************************************************
Настройка вашего приложения
********************************************************************************
Теперь вы должны получить представление о том, как легко можно изменить приложения Mapbender без изменения кода.

Когда вы выбираете элемент, например, **mapframe1** щелчком по переключателю, вы видите, что элемент имеет множество атрибутов. Эти атрибуты являются тэгами HTML. Определяя элементы Mapbender, вы определяете элементы HTML. При запуске вашего приложения Mapbender генерирует страницу HTML с использованием всех определённых элементов.

	* id — уникальное имя элемента
	* on/off — активировать/деактивировать элемент
	* title — имя для всплывающей подсказки вкладки
	* HTML-TAG/CLOSE-TAG — введите элементы HTML для определения тэгов, например, div, img
	* top, left — определите позицию элемента (для фиксированных раскладок)
	* width/height — определите размер элемента

Некоторые элементы имеют свойства, которые позволяют пользователю устанавливать их самостоятельно (не выбирать из списка). Свойства могут быть переменными языков программирования JavaScript или PHP, ссылками на файлы CSS или текстовыми определениями CSS. 

Примеры для различных элементов:

* элемент *copyright* имеет свойство для установки текста копирайта;
* элемент *overview* (обзор карты) имеет свойство для определения WMS, используемого для обзорной карты;
* *treeGDE* (проводник пространственных данных) имеет свойство для определения стиля проводника.


Попробуйте сами
================================================================================
* изменить размер окна карты (элемент *mapframe1*);
* изменить логотип — используйте foss4g-logo в качестве изображения логотипа (элемент *logo*);
* установить цвет фона (элемент body element-variable css_class_bg);
* изменить местоположение управляющих элементов (изменить местоположение верхнего левого угла элемента на другую пиксельную позицию);
* изменить копирайт.

********************************************************************************
Управление пользователями и группами
********************************************************************************
Доступ к Mapbender всегда требует аутентификации. Пользователь может получить доступ к приложениям и сервисам (WMS, WFS) после входа.

Нет никакого различия между встроенными ролями :guilabel:`guest`, :guilabel:`operator`, :guilabel:`administrator`, :guilabel:`role`. Функциональность зависит от сервисов, к которым пользователь имеет доступ.


Создание пользователя
================================================================================

#. Для создания пользователя перейдите по ссылке :guilabel:`admin2_en` и выберите :menuselection:`User Management --> Create and edit user`.

#. Введите имя пользователя и пароль. 

.. image:: /images/screenshots/800x600/mapbender_create_user.png
     :scale: 80 


Создание группы
================================================================================
#. Создайте группу при помощи :menuselection:`User Management --> Create and edit group`. Укажите имя и описание для вашей группы.


Назначение приложения пользователю/группе
================================================================================

#. Введите пользователя в группу при помощи :menuselection:`User Management --> Add one user to several groups` или по ссылке :menuselection:`User Management --> Add several users to one group`

#. Назначьте пользователя приложению при помощи :menuselection:`User Management --> Allow one user to access several applications`

#. Назначьте приложение группе при помощи :menuselection:`User Management --> Allow one group to access several applications`

.. tip:: Если вам нужно предоставить пользователю доступ на запись в приложении, необходимо воспользоваться меню :menuselection:`User Management --> Assign to edit an application to a user`

#. Осуществите выход из Mapbender при помощи кнопки |LOGOUT|.

#. Войдите под новым пользователем

#. Что произойдет, если пользователь имеет доступ к нескольким приложениям?

  .. |LOGOUT| image:: /images/screenshots/800x600/mapbender_logout.png
     :scale: 100

********************************************************************************
Управление WFS
********************************************************************************
Mapbender поддерживает OGC Web Feature Service (WFS) версий 1.0.0 и 1.1.0. WFS может быть использован приложениях Mapbender для различных целей:

* поиск;
* пространственный поиск;
* редактирование;
* отображение информации;
* генерация всплывающих подсказок;
* загрузка данных.

Чтобы воспользоваться WFS, вам необходимо загрузить WFS в Mapbender и сгенерировать его конфигурацию.

После этого вы должны предоставить доступ к вашей новой конфигурации, прежде чем вы сможете использовать её.

Если вам необходимо настроить приложение с поддержкой редактирования WFS, вам необходим WFS, поддерживающий транзакции (WFS-T). Например, вы можете воспользоваться :doc:`GeoServer <../overview/geoserver_overview>` или иной WFS-T.

Загрузка WFS
================================================================================
Модуль для настройки WFS интегрирован в административное приложение **admin_en_services**.

#. Перейдите в *admin_en_services* и выберите *WFS Management --> Load WFS*. Выберите приложение в списке. Укажите ссылку на WFS **getCapabilities** URL в текстовом поле и нажмите **Load**.

.. tip:: В начале следует проверить корректность документа WFS getCapabilities в окне браузера прежде чем загружать его в Mapbender.

Демонстрация WFS:

http://wms.wheregroup.com/geoserver/wfs?REQUEST=getCapabilities&VERSION=1.0.0&SERVICE=WFS

.. image:: /images/screenshots/800x600/mapbender_loadWFS.png
     :scale: 80 

Создание конфигурации WFS
================================================================================
На следующем шаге настроим конфигурацию WFS. После настройки и аутентификации в приложении, конфигурация может быть использована.

.. image:: /images/screenshots/800x600/mapbender_configure_WFS_featureType.png
     :scale: 80 

**Конфигурация**

#. Для начала вам надо выбрать WFS из списка *Select WFS*. Все типы, поддерживаемые этим WFS будут перечислены;
#. выберите тип, который необходимо настроить;
#. после выбора типа, возникнет пара полей ввода (поля настройки, поля атрибутов);
#. введите абстракт и метку вашего поиска;
#. определите текст на кнопке поиска (например, OK или поиск);
#. в стиле или блоке стиля результатов вы можете определить текст CSS;
#. определите буфер, который может быть использован при увеличении на объекте в записи результатов поиска;
#. выберите колонку геометрии;
#. search / pos — определите колонки для поиска и их порядок (pos для позиции), в котором они должны отображаться;
#. minimum_input (**Search**) - определите минимальное количество символов для поля
#. label — определите метку для колонки поиска  
#. show — определите колонки, которые необходимо отобразить в списке результатов и их порядок;
#. show_detail — определите колонки, которые необходимо отображать в окне информации о выделенном объекте;
#. mandatory (**digitizing**) — колонку необходимо установить;
#. edit (**digitizing**) — определите, какую колонку назначить для редактирования;
#. html — определите *selectbox*, *datepicker*, *checkbox*, *textarea* или *file upload* вместо простого текстового поля;
#. auth — здесь вы можете определить порядок аутентификации, чтобы обеспечить доступ к пространственным объектам;
#. operator (**Search**) — определите, какой оператор использовать для поиска;
#. helptext — определить текст справки для каждого поля;
#. category — вы можете определить категории. Атрибут будет назначен этой категории и будет показан во вкладке с именем категории;
#. **save** сохраните ваши настройки;
#. вашей конфигурации будет присвоен идентификатор.


.. image:: /images/screenshots/800x600/mapbender_configure_WFS_featureType_attribute_table.png
     :scale: 80 

Назначение конфигурации WFS-приложению
================================================================================
Новая конфигурация должна быть назначена одному или нескольким приложениям. Это делается при помощи *WFS configuration -> Assign WFS conf to application*.

#. Выберите WFS
#. Выберите приложение
#. Переместите вашу конфигурацию *GUI configuration list* вправо

.. image:: /images/screenshots/800x600/mapbender_set_featureType_access.png
     :scale: 80 


Настройка поиска в WFS
================================================================================
Для настройки WFS в приложении перейдите *admin_en_services -> Edit application elements* выберите ваше приложение и перейдите к элементу *gazetteerWFS*. Элемент имеет свойство *wfsConfIdString*. Здесь вы можете просмотреть список конфигураций WFS (разделены запятой). В порядке списка будут отображаться результаты поиска.

.. image:: /images/screenshots/800x600/mapbender_wfsConfIdString.png
     :scale: 80 

Обратите внимание, как поиск может быть использован в вашем приложении. В примере ниже имеется фрейм слева, в котором осуществляется поиск пользователя Mapbender. Вы можете запустить пространственный поиск и определить регион или осуществить пространственный поиск. Результаты поиска будут отображены в специальной таблице. По щелчку на строке таблицы результатов Mapbender приближается к местоположению объекта и выводит детальную информацию.

.. image:: /images/screenshots/800x600/mapbender_WFS_search.png
     :scale: 100

Настройка возможности редактирования в WFS
================================================================================
Наиболее простой путь добавить возможность редактирования WFS в ваше приложение — скопировать *gui_digitize*. Теперь вам нужно только подключиться к слою WMS с определенной конфигурацией пространственных объектов. Это делается при помощи *WMS application settings* с кнопкой *set WFS* в списке слоёв. Нажмите на кнопку и введите ваш идентификатор конфигурации.

.. tip:: Убедитесь, что слой WMS, который соединён с конфигурацией WFS, поддерживает запрос атрибутов. Таким образом Mapbender определяет, когда посылать запросы WFS **getFeature**.

Теперь вы можете искать с использованием пространственных запросов объекты, отображаемые в текущий момент на карте. Объекты могут быть изменены (перемещены, добавлены точки, отредактированы их атрибуты, разбиты или продолжены линии, объединены полигоны). Также вы можете создавать новые объекты.

.. image:: /images/screenshots/800x600/mapbender_gui_digitize.png
     :scale: 80 

Что можно попробовать
================================================================================

Вот некоторые дополнительные задачи, чтобы попробовать:

#. Попробуйте загрузить какой-нибудь WMS в вашем приложение. Попробуйте сконфигурировать ваш WMS с использованием :menuselection:`Configure WMS access --> WMS application settings`.

#. Попробуйте создать отдельное приложение — измените цвет фона, переместите кнопки, измените размер карты (элемент *mapframe1*). :menuselection:`Application Management --> Edit application elements`.


Что дальше?
================================================================================

Это только первый шаг на пути к использованию Mapbender. Существует гораздо больше функций, которые вы можете попробовать.

Домашняя страница Mapbender:

  http://www.mapbender.org/

Руководства могут быть найдены по этой ссылке:

  http://www.mapbender.org/Tutorials

Посмотрите руководства на английском языке:

  http://www.mapbender.org/Mapbender_Tutorial_en

Узнайте больше о Mapbender: 
	
	http://projects.mapbender.osgeo.org

Примите участие в проекте:

	http://www.mapbender.org/Community
