
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="ja">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>PostGIS クイックスタート &#8212; OSGeoLive 14.0 Documentation</title>
    <link rel="stylesheet" href="../../_static/overview.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '14.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="copyright" title="著作権" href="../copyright.html" />
    <link rel="next" title="pgRouting" href="../overview/pgrouting_overview.html" />
    <link rel="prev" title="PostGIS" href="../overview/postgis_overview.html" />
	<script type="text/javascript" src="../../_static/osgeolive.js"></script>


  </head>
  <body>

        
        
    <div class="header">
	<div class="banner"><a href="http://live.osgeo.org/"><img src="../../_images/banner.png"></a></div>
        <div class="nowrap">
            <ul id="top-nav">
              <li><a href="../index.html">Home</a></li>
              <li><a href="../overview/overview.html">Contents</a></li>
              <li><a href="../download.html">Download</a></li>
              <li><a href="../metrics.html">Metrics</a></li>
              <li><a href="../sponsors.html">Sponsors</a></li>
              <li><a href="../contact.html">Contact Us</a></li>
            </ul>
        </div>
    </div>
    </div> 
        


    
    <div class="related">
	<font size="-2">
		<div id="translations">
		<!-- alphabetical order -->
              <a href="javascript:defaultRedirect('en')">English</a> |   <a href="javascript:defaultRedirect('de')">Deutsch</a> |   <a href="javascript:defaultRedirect('es')">Español</a> |   <a href="javascript:defaultRedirect('fi')">Suomen kieli</a> |   <a href="javascript:defaultRedirect('fr')">Français</a> |   <a href="javascript:defaultRedirect('it')">Italiano</a> |   <a href="javascript:defaultRedirect('ja')">日本語</a> |   <a href="javascript:defaultRedirect('hu')">Hungarian</a>
		</div>
	</font>
    </div>



    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <a class="reference external image-reference" href="http://postgis.net"><img alt="../../_images/logo_postgis.png" class="align-right" src="../../_images/logo_postgis.png" /></a>
<a class="reference external image-reference" href="https://www.osgeo.org"><img alt="../../_images/OSGeo_project.png" class="align-right" src="../../_images/OSGeo_project.png" /></a>
<div class="section" id="postgis-quickstart">
<h1>PostGIS クイックスタート<a class="headerlink" href="#postgis-quickstart" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>PostGISは、PostgreSQLリレーショナルデータベースに空間機能を追加します。PostgreSQLを拡張して、空間データを格納、問い合わせ、操作できるようにします。このクイックスタートでは、一般的なデータベース関数を記述する場合は 『PostgreSQL』 を使用し、PostGISによって提供される追加の空間機能を記述する場合は 『PostGIS』 を使用します。</p>
<p>このクイックスタートでは、次の方法について説明します:</p>
<blockquote>
<div><ul class="simple">
<li>コマンドラインと  <a class="reference internal" href="../overview/qgis_overview.html"><span class="doc">QGIS</span></a> グラフィカルクライアントから空間データベースを作成し、クエリーを実行します。</li>
<li><code class="docutils literal"><span class="pre">pgAdmin</span></code> クライアントからデータを管理します。</li>
</ul>
</div></blockquote>
<div class="contents local topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#client-server-architecture" id="id1">クライアント/サーバ・アーキテクチャ</a></li>
<li><a class="reference internal" href="#creating-a-spatially-enabled-database" id="id2">空間的に有効なデータベースの作成</a></li>
<li><a class="reference internal" href="#creating-a-spatial-table-using-sql" id="id3">SQLを使用した空間テーブルの作成</a></li>
<li><a class="reference internal" href="#simple-queries" id="id4">単純なクエリー</a></li>
<li><a class="reference internal" href="#spatial-queries" id="id5">空間クエリー</a></li>
<li><a class="reference internal" href="#mapping" id="id6">マッピング</a></li>
<li><a class="reference internal" href="#importing-spatial-data-into-the-database" id="id7">空間データをデータベースに読み込む</a></li>
<li><a class="reference internal" href="#get-to-know-pgadmin" id="id8">Get to know pgAdmin</a></li>
<li><a class="reference internal" href="#executing-a-sql-query-from-pgadmin" id="id9">Executing a SQL query from pgAdmin</a></li>
<li><a class="reference internal" href="#get-to-know-foreign-data-wrappers-fdw" id="id10">外部データラッパー(FDW)について知る</a></li>
<li><a class="reference internal" href="#connect-to-a-remote-ogr-data-source-via-ogr-fdw" id="id11">ogr_fdw経由でリモートOGRデータソースに接続</a></li>
<li><a class="reference internal" href="#things-to-try" id="id12">試してみること</a></li>
<li><a class="reference internal" href="#what-next" id="id13">次のステップ</a></li>
</ul>
</div>
<div class="section" id="client-server-architecture">
<h2><a class="toc-backref" href="#id1">クライアント/サーバ・アーキテクチャ</a><a class="headerlink" href="#client-server-architecture" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>PostgreSQLは、多くのデータベースと同様に、クライアント/サーバシステムのサーバとして機能します。クライアントはサーバーに要求を行い、応答を受け取ります。これは、インターネットが動作するのと同じ方法です。つまり、ブラウザあり、WebサーバはWebページを送り返します。PostgreSQLでは、要求はSQL言語で行われ、応答は通常データベースからのデータのテーブルです。</p>
<p>サーバがクライアントと同じコンピュータ上にあることを止めるものは何もありません。これにより、単一のマシン上でPostgreSQLを使用することができます。クライアントは、内部の 『ループバック』 ネットワーク接続を介してサーバに接続し、そのように設定しない限り、他のコンピュータからは見えません。</p>
</div>
<div class="section" id="creating-a-spatially-enabled-database">
<h2><a class="toc-backref" href="#id2">空間的に有効なデータベースの作成</a><a class="headerlink" href="#creating-a-spatially-enabled-database" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>コマンドラインクライアントは、ターミナルエミュレータウィンドウから実行します。</p>
<p>「システムツール」メニューからターミナルエミュレータ(現在はLXTerminal)を起動します。これにより、Unixシェルのコマンドプロンプトが表示されます。Type:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">psql</span> <span class="o">-</span><span class="n">V</span>
</pre></div>
</div>
<p>エンターを押してPostgreSQLのバージョン番号を確認します。</p>
<p>単一のPostgreSQLサーバでは、作業を別々のデータベースに整理することで、作業を組織することができます。各データベースは、独自のテーブル、ビュー、ユーザなどを持つ独立したシステムです。PostgreSQLサーバに接続する場合、データベースを指定する必要があります。</p>
<p>次のコマンドを使用すると、サーバ上のデータベースのリストを取得できます:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">psql</span> <span class="o">-</span><span class="n">l</span>
</pre></div>
</div>
<p>. システム上の一部のプロジェクトで使用されている複数のデータベースが表示されます。このクイックスタート用に新しいものを作成します。</p>
<div class="admonition tip">
<p class="first admonition-title">ちなみに</p>
<p class="last">このリストでは標準的なUNIXのページャの使いかたを示します - スペースで次のページ、 <code class="kbd docutils literal"><span class="pre">b</span></code> は戻る、 <code class="kbd docutils literal"><span class="pre">q</span></code> は終了、h はヘルプを表示します。</p>
</div>
<p>PostgreSQLは、データベースを作成するためのユーティリティプログラム <code class="docutils literal"><span class="pre">createdb</span></code> を提供します。PostGIS拡張を追加する前に、データベースを作成する必要があります。わたしたちのデータベースを <code class="docutils literal"><span class="pre">demo</span></code> と呼びます。コマンドは次のようになります:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">createdb</span> <span class="n">demo</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">ちなみに</p>
<p class="last">通常、コマンドラインツールのヘルプを表示するには、 <code class="docutils literal"><span class="pre">--help</span></code> オプションを使います。</p>
</div>
<p>ここで <code class="docutils literal"><span class="pre">psql</span> <span class="pre">-l</span></code> を実行すると、リストに <code class="docutils literal"><span class="pre">demo</span></code> データベースが表示されます。PostGIS拡張はまだ追加されていませんが、次のセクションでその方法を学習します。</p>
<p>PostGISデータベースは、SQL言語を使用して作成できます。最初に <code class="docutils literal"><span class="pre">dropdb</span></code> コマンドを使って作成したデータベースを削除し、次に <code class="docutils literal"><span class="pre">psql</span></code> コマンドを使ってSQLコマンドインタプリタを取得します。</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">dropdb</span> <span class="n">demo</span>
<span class="n">psql</span> <span class="o">-</span><span class="n">d</span> <span class="n">postgres</span>
</pre></div>
</div>
<p>これは <code class="docutils literal"><span class="pre">postgres</span></code> と呼ばれるコアシステムデータベースに接続します。次に、SQLを入力して新しいデータベースを作成します。</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">postgres</span><span class="o">=</span><span class="c1"># CREATE DATABASE demo;</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">postgres</span></code> データベースから新しい <code class="docutils literal"><span class="pre">demo</span></code> データベースに接続を切り替えます。将来的には <code class="docutils literal"><span class="pre">psql</span> <span class="pre">-d</span> <span class="pre">demo</span></code> で直接接続することもできますが、 <code class="docutils literal"><span class="pre">psql</span></code> コマンドラインで切り替えるには、次のような便利な方法があります。</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">postgres</span><span class="o">=</span><span class="c1"># \c demo</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">ちなみに</p>
<p class="last">returnを押してもpsqlプロンプトが表示され続ける場合は、 <code class="kbd docutils literal"><span class="pre">CTRL</span></code> + <code class="kbd docutils literal"><span class="pre">C</span></code> を押します。入力がクリアされ、再び起動します。おそらく、閉じる引用符やセミコロンなどを待っているのでしょう。</p>
</div>
<p>情報メッセージが表示され、 <code class="docutils literal"><span class="pre">demo</span></code> データベースに接続したことを示すプロンプトが表示されます。</p>
<p>次に、PostGIS拡張を追加します。</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">demo</span><span class="o">=</span><span class="c1"># create extension postgis;</span>
</pre></div>
</div>
<p>postgisがインストールされていることを確認するには、次のクエリを実行します:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">demo</span><span class="o">=</span><span class="c1"># SELECT postgis_version();</span>

           <span class="n">postgis_version</span>
<span class="o">---------------------------------------</span>
 <span class="mf">2.3</span> <span class="n">USE_GEOS</span><span class="o">=</span><span class="mi">1</span> <span class="n">USE_PROJ</span><span class="o">=</span><span class="mi">1</span> <span class="n">USE_STATS</span><span class="o">=</span><span class="mi">1</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>
</pre></div>
</div>
<p>PostGISは、多くの関数、テーブル、および複数のビューをインストールします。</p>
<p><code class="docutils literal"><span class="pre">\dt</span></code> と入力、データベース内のテーブルを一覧表示します。次のように表示されます。</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">demo</span><span class="o">=</span><span class="c1"># \dt</span>
             <span class="n">List</span> <span class="n">of</span> <span class="n">relations</span>
 <span class="n">Schema</span> <span class="o">|</span>       <span class="n">Name</span>       <span class="o">|</span> <span class="n">Type</span>  <span class="o">|</span> <span class="n">Owner</span>
<span class="o">--------+------------------+-------+-------</span>
 <span class="n">public</span> <span class="o">|</span> <span class="n">spatial_ref_sys</span>  <span class="o">|</span> <span class="n">table</span> <span class="o">|</span> <span class="n">user</span>
<span class="p">(</span><span class="mi">1</span> <span class="n">row</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">spatial_ref_sys</span></code> テーブルは、PostGISが異なる空間参照システム間の変換に使用します。 <code class="docutils literal"><span class="pre">spatial_ref_sys</span></code> テーブルには、有効な空間参照システムに関する情報が格納されています。SQLを使用して簡単に確認できます。</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">demo</span><span class="o">=</span><span class="c1"># SELECT srid, auth_name, proj4text FROM spatial_ref_sys LIMIT 10;</span>

 <span class="n">srid</span> <span class="o">|</span> <span class="n">auth_name</span> <span class="o">|</span>          <span class="n">proj4text</span>
<span class="o">------+-----------+--------------------------------------</span>
 <span class="mi">3819</span> <span class="o">|</span> <span class="n">EPSG</span>      <span class="o">|</span> <span class="o">+</span><span class="n">proj</span><span class="o">=</span><span class="n">longlat</span> <span class="o">+</span><span class="n">ellps</span><span class="o">=</span><span class="n">bessel</span> <span class="o">+</span><span class="n">towgs</span><span class="o">...</span>
 <span class="mi">3821</span> <span class="o">|</span> <span class="n">EPSG</span>      <span class="o">|</span> <span class="o">+</span><span class="n">proj</span><span class="o">=</span><span class="n">longlat</span> <span class="o">+</span><span class="n">ellps</span><span class="o">=</span><span class="n">aust_SA</span> <span class="o">+</span><span class="n">no_d</span><span class="o">...</span>
 <span class="mi">3824</span> <span class="o">|</span> <span class="n">EPSG</span>      <span class="o">|</span> <span class="o">+</span><span class="n">proj</span><span class="o">=</span><span class="n">longlat</span> <span class="o">+</span><span class="n">ellps</span><span class="o">=</span><span class="n">GRS80</span> <span class="o">+</span><span class="n">towgs8</span><span class="o">...</span>
 <span class="mi">3889</span> <span class="o">|</span> <span class="n">EPSG</span>      <span class="o">|</span> <span class="o">+</span><span class="n">proj</span><span class="o">=</span><span class="n">longlat</span> <span class="o">+</span><span class="n">ellps</span><span class="o">=</span><span class="n">GRS80</span> <span class="o">+</span><span class="n">towgs8</span><span class="o">...</span>
 <span class="mi">3906</span> <span class="o">|</span> <span class="n">EPSG</span>      <span class="o">|</span> <span class="o">+</span><span class="n">proj</span><span class="o">=</span><span class="n">longlat</span> <span class="o">+</span><span class="n">ellps</span><span class="o">=</span><span class="n">bessel</span> <span class="o">+</span><span class="n">no_de</span><span class="o">...</span>
 <span class="mi">4001</span> <span class="o">|</span> <span class="n">EPSG</span>      <span class="o">|</span> <span class="o">+</span><span class="n">proj</span><span class="o">=</span><span class="n">longlat</span> <span class="o">+</span><span class="n">ellps</span><span class="o">=</span><span class="n">airy</span> <span class="o">+</span><span class="n">no_defs</span><span class="o">...</span>
 <span class="mi">4002</span> <span class="o">|</span> <span class="n">EPSG</span>      <span class="o">|</span> <span class="o">+</span><span class="n">proj</span><span class="o">=</span><span class="n">longlat</span> <span class="o">+</span><span class="n">a</span><span class="o">=</span><span class="mf">6377340.189</span> <span class="o">+</span><span class="n">b</span><span class="o">=</span><span class="mf">63.</span><span class="o">..</span>
 <span class="mi">4003</span> <span class="o">|</span> <span class="n">EPSG</span>      <span class="o">|</span> <span class="o">+</span><span class="n">proj</span><span class="o">=</span><span class="n">longlat</span> <span class="o">+</span><span class="n">ellps</span><span class="o">=</span><span class="n">aust_SA</span> <span class="o">+</span><span class="n">no_d</span><span class="o">...</span>
 <span class="mi">4004</span> <span class="o">|</span> <span class="n">EPSG</span>      <span class="o">|</span> <span class="o">+</span><span class="n">proj</span><span class="o">=</span><span class="n">longlat</span> <span class="o">+</span><span class="n">ellps</span><span class="o">=</span><span class="n">bessel</span> <span class="o">+</span><span class="n">no_de</span><span class="o">...</span>
 <span class="mi">4005</span> <span class="o">|</span> <span class="n">EPSG</span>      <span class="o">|</span> <span class="o">+</span><span class="n">proj</span><span class="o">=</span><span class="n">longlat</span> <span class="o">+</span><span class="n">a</span><span class="o">=</span><span class="mf">6377492.018</span> <span class="o">+</span><span class="n">b</span><span class="o">=</span><span class="mf">63.</span><span class="o">..</span>
<span class="p">(</span><span class="mi">10</span> <span class="n">rows</span><span class="p">)</span>
</pre></div>
</div>
<p>これにより、空間的に有効なデータベースがあることが確認されます。</p>
<p>この表に加えて、データベースでpostgisを有効にしたときに作成されるいくつかのビューがあります。</p>
<p><code class="docutils literal"><span class="pre">\dv</span></code> と入力すると、データベース内のビューの一覧が表示されます。次のように表示されます。</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">demo</span><span class="o">=</span><span class="c1"># \dv</span>
                                                                <span class="n">List</span> <span class="n">of</span> <span class="n">relations</span>
 <span class="n">Schema</span> <span class="o">|</span>       <span class="n">Name</span>        <span class="o">|</span> <span class="n">Type</span> <span class="o">|</span>  <span class="n">Owner</span>
<span class="o">--------+-------------------+------+----------</span>
 <span class="n">public</span> <span class="o">|</span> <span class="n">geography_columns</span> <span class="o">|</span> <span class="n">view</span> <span class="o">|</span> <span class="n">postgres</span>
 <span class="n">public</span> <span class="o">|</span> <span class="n">geometry_columns</span>  <span class="o">|</span> <span class="n">view</span> <span class="o">|</span> <span class="n">postgres</span>
 <span class="n">public</span> <span class="o">|</span> <span class="n">raster_columns</span>    <span class="o">|</span> <span class="n">view</span> <span class="o">|</span> <span class="n">postgres</span>
 <span class="n">public</span> <span class="o">|</span> <span class="n">raster_overviews</span>  <span class="o">|</span> <span class="n">view</span> <span class="o">|</span> <span class="n">postgres</span>
<span class="p">(</span><span class="mi">4</span> <span class="n">rows</span><span class="p">)</span>
</pre></div>
</div>
<p>PostGISは、いくつかの空間データタイプをサポートしています:</p>
<blockquote>
<div><p><cite>geometry</cite> - データを平面に描かれたベクトルとして格納するデータ型です。</p>
<p><cite>geography</cite> - 回転楕円面上に描かれたベクトルとしてデータを保存するデータ型です。</p>
<dl class="docutils">
<dt><cite>raster</cite> - データをn次元の行列として格納するデータ型で、各位置(ピクセル)は</dt>
<dd>空間の領域を示し、各バンド(次元)は各ピクセル空間の値を持つ。</dd>
</dl>
</div></blockquote>
<p><code class="docutils literal"><span class="pre">geometry_columns</span></code> と、 <code class="docutils literal"><span class="pre">geography_columns</span></code> 、 <code class="docutils literal"><span class="pre">raster_columns</span></code> ビューは、PostGISのジオメトリ、地理、およびラスター列を持つテーブルをPostGIS に伝える役割をもっています。</p>
<p>概要は、ラスターデータの低解像度テーブルです。<code class="docutils literal"><span class="pre">raster_overviews</span></code> このようなテーブルとそのラスタ列がリストされ、それぞれのテーブルが概要を示しています。ラスタデータ概要テーブルは、QGISなどのツールで使用され、ラスタデータの低解像度バージョンを提供して、読み込みを高速化します。</p>
<p>PostGISジオメトリタイプは、PostGISユーザが使用する最初の最も一般的なタイプです。そのタイプに注目してみましょう。</p>
</div>
<div class="section" id="creating-a-spatial-table-using-sql">
<h2><a class="toc-backref" href="#id3">SQLを使用した空間テーブルの作成</a><a class="headerlink" href="#creating-a-spatial-table-using-sql" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>これで空間データベースが完成し、空間テーブルを作成できるようになりました。</p>
<p>まず、都市データを保存するための通常のデータベーステーブルを作成します。このテーブルには3つのフィールドがあります。1つは都市を識別する数値ID用、1つは都市名用、もう1つはジオメトリ列用です。</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">demo</span><span class="o">=</span><span class="c1"># CREATE TABLE cities ( id int4 primary key, name varchar(50), geom geometry(POINT,4326) );</span>
</pre></div>
</div>
<p>従来、このジオメトリカラムには <code class="docutils literal"><span class="pre">geom</span></code> という名前(古いPostGISでは <code class="docutils literal"><span class="pre">the_geom</span></code> でした)を使います。これにより、PostGISに、各フィーチャが持つジオメトリの種類(ポイント、ライン、ポリゴンなど)、寸法の数(この場合は2、寸法が3または4の場合はPOINTZ、POINTM、またはPOINTZMを使用)、および空間参照システムが通知されます。我々の都市には、EPSG:4326座標を使用しました。</p>
<p>citiesテーブルをチェックすると、新しい列が表示され、テーブルに現在行が含まれていないことが通知されます。</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">demo</span><span class="o">=</span><span class="c1"># SELECT * from cities;</span>
 <span class="nb">id</span> <span class="o">|</span> <span class="n">name</span> <span class="o">|</span> <span class="n">geom</span>
<span class="o">----+------+----------</span>
<span class="p">(</span><span class="mi">0</span> <span class="n">rows</span><span class="p">)</span>
</pre></div>
</div>
<p>テーブルに行を追加するには、いくつかのSQL文を使用します。ジオメトリ列にジオメトリを取得するには、PostGISの <code class="docutils literal"><span class="pre">ST_GeomFromText</span></code> 関数を使用して、座標と空間参照システムIDを与えるテキスト形式から変換します:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">demo</span><span class="o">=</span><span class="c1"># INSERT INTO cities (id, geom, name) VALUES (1,ST_GeomFromText(&#39;POINT(-0.1257 51.508)&#39;,4326),&#39;London, England&#39;);</span>
<span class="n">demo</span><span class="o">=</span><span class="c1"># INSERT INTO cities (id, geom, name) VALUES (2,ST_GeomFromText(&#39;POINT(-81.233 42.983)&#39;,4326),&#39;London, Ontario&#39;);</span>
<span class="n">demo</span><span class="o">=</span><span class="c1"># INSERT INTO cities (id, geom, name) VALUES (3,ST_GeomFromText(&#39;POINT(27.91162491 -33.01529)&#39;,4326),&#39;East London,SA&#39;);</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">ちなみに</p>
<p class="last">矢印キーを使用して、コマンドラインを呼び出したり編集します。</p>
</div>
<p>ご覧のように、これは非常に時間のかかる作業になります。幸いなことに、PostGISテーブルにデータを取り込む方法は他にもあり、その方がずっと簡単です。しかし今では3つの都市がデータベースに登録されています。</p>
</div>
<div class="section" id="simple-queries">
<h2><a class="toc-backref" href="#id4">単純なクエリー</a><a class="headerlink" href="#simple-queries" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>通常のすべてのSQL操作を適用して、PostGISテーブルからデータを選択できます。</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">demo</span><span class="o">=</span><span class="c1"># SELECT * FROM cities;</span>
 <span class="nb">id</span> <span class="o">|</span>      <span class="n">name</span>       <span class="o">|</span>                      <span class="n">geom</span>
<span class="o">----+-----------------+----------------------------------------------------</span>
  <span class="mi">1</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">England</span> <span class="o">|</span> <span class="mf">0101000020E6100000</span><span class="n">BBB88D06F016C0BF1B2FDD2406C14940</span>
  <span class="mi">2</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Ontario</span> <span class="o">|</span> <span class="mf">0101000020E6100000</span><span class="n">F4FDD478E94E54C0E7FBA9F1D27D4540</span>
  <span class="mi">3</span> <span class="o">|</span> <span class="n">East</span> <span class="n">London</span><span class="p">,</span><span class="n">SA</span>  <span class="o">|</span> <span class="mf">0101000020E610000040</span><span class="n">AB064060E93B4059FAD005F58140C0</span>
<span class="p">(</span><span class="mi">3</span> <span class="n">rows</span><span class="p">)</span>
</pre></div>
</div>
<p>これにより、座標のエンコードされた16進数バージョンが得られますが、人間にとってはあまり有用ではありません。</p>
<p>ジオメトリを再びWKT形式で表示する場合は、関数ST_AsText(geom)またはST_AsEwkt(geom)を使用できます。ST_X(geom)、ST_Y(geom)を使用して、座標の数値を取得することもできます。</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">demo</span><span class="o">=</span><span class="c1"># SELECT id, ST_AsText(geom), ST_AsEwkt(geom), ST_X(geom), ST_Y(geom) FROM cities;</span>
 <span class="nb">id</span> <span class="o">|</span>          <span class="n">st_astext</span>           <span class="o">|</span>               <span class="n">st_asewkt</span>                <span class="o">|</span>    <span class="n">st_x</span>     <span class="o">|</span>   <span class="n">st_y</span>
<span class="o">----+------------------------------+----------------------------------------+-------------+-----------</span>
  <span class="mi">1</span> <span class="o">|</span> <span class="n">POINT</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1257</span> <span class="mf">51.508</span><span class="p">)</span>        <span class="o">|</span> <span class="n">SRID</span><span class="o">=</span><span class="mi">4326</span><span class="p">;</span><span class="n">POINT</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1257</span> <span class="mf">51.508</span><span class="p">)</span>        <span class="o">|</span>     <span class="o">-</span><span class="mf">0.1257</span> <span class="o">|</span>    <span class="mf">51.508</span>
  <span class="mi">2</span> <span class="o">|</span> <span class="n">POINT</span><span class="p">(</span><span class="o">-</span><span class="mf">81.233</span> <span class="mf">42.983</span><span class="p">)</span>        <span class="o">|</span> <span class="n">SRID</span><span class="o">=</span><span class="mi">4326</span><span class="p">;</span><span class="n">POINT</span><span class="p">(</span><span class="o">-</span><span class="mf">81.233</span> <span class="mf">42.983</span><span class="p">)</span>        <span class="o">|</span>     <span class="o">-</span><span class="mf">81.233</span> <span class="o">|</span>    <span class="mf">42.983</span>
  <span class="mi">3</span> <span class="o">|</span> <span class="n">POINT</span><span class="p">(</span><span class="mf">27.91162491</span> <span class="o">-</span><span class="mf">33.01529</span><span class="p">)</span> <span class="o">|</span> <span class="n">SRID</span><span class="o">=</span><span class="mi">4326</span><span class="p">;</span><span class="n">POINT</span><span class="p">(</span><span class="mf">27.91162491</span> <span class="o">-</span><span class="mf">33.01529</span><span class="p">)</span> <span class="o">|</span> <span class="mf">27.91162491</span> <span class="o">|</span> <span class="o">-</span><span class="mf">33.01529</span>
<span class="p">(</span><span class="mi">3</span> <span class="n">rows</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="spatial-queries">
<h2><a class="toc-backref" href="#id5">空間クエリー</a><a class="headerlink" href="#spatial-queries" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>PostGISはPostgreSQLに空間機能を持つ多くの関数を追加します。WKTをジオメトリに変換するST_GeomFromTextについては、すでに説明しました。そのほとんどはST(空間タイプ)で始まり、PostGISドキュメントのセクションにリストされています。ここでは、球形の地球を仮定して、これら3つのロンドンが互いにどのくらい離れているのかという現実的な疑問に答えるために1つを使うことにしよう。</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">demo</span><span class="o">=</span><span class="c1"># SELECT p1.name,p2.name,ST_DistanceSphere(p1.geom,p2.geom) FROM cities AS p1, cities AS p2 WHERE p1.id &gt; p2.id;</span>
      <span class="n">name</span>       <span class="o">|</span>      <span class="n">name</span>       <span class="o">|</span> <span class="n">st_distancesphere</span>
<span class="o">-----------------+-----------------+--------------------</span>
 <span class="n">London</span><span class="p">,</span> <span class="n">Ontario</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">England</span> <span class="o">|</span>   <span class="mf">5875766.85191657</span>
 <span class="n">East</span> <span class="n">London</span><span class="p">,</span><span class="n">SA</span>  <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">England</span> <span class="o">|</span>   <span class="mf">9789646.96784908</span>
 <span class="n">East</span> <span class="n">London</span><span class="p">,</span><span class="n">SA</span>  <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Ontario</span> <span class="o">|</span>   <span class="mf">13892160.9525778</span>
 <span class="p">(</span><span class="mi">3</span> <span class="n">rows</span><span class="p">)</span>
</pre></div>
</div>
<p>これにより、都市間の距離がメートル単位でわかります。SQL行の’WHERE’部分が、都市からそれ自体までの距離(すべて0)または上記の表の逆方向の距離(英国ロンドンからオンタリオロンドンまでは、オンタリオロンドンからイギリスロンドンまでと同じ距離)を取得するのを停止することに注意してください。』WHERE’の部分を外して試してみて、何が起こるか見てください。</p>
<p>また、別の関数を使用し、回転楕円体の名前、半長軸、および逆平坦化パラメータを指定して、回転楕円体を使用して距離を計算することもできます。</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">demo</span><span class="o">=</span><span class="c1"># SELECT p1.name,p2.name,ST_DistanceSpheroid(</span>
        <span class="n">p1</span><span class="o">.</span><span class="n">geom</span><span class="p">,</span><span class="n">p2</span><span class="o">.</span><span class="n">geom</span><span class="p">,</span> <span class="s1">&#39;SPHEROID[&quot;GRS_1980&quot;,6378137,298.257222]&#39;</span>
        <span class="p">)</span>
       <span class="n">FROM</span> <span class="n">cities</span> <span class="n">AS</span> <span class="n">p1</span><span class="p">,</span> <span class="n">cities</span> <span class="n">AS</span> <span class="n">p2</span> <span class="n">WHERE</span> <span class="n">p1</span><span class="o">.</span><span class="n">id</span> <span class="o">&gt;</span> <span class="n">p2</span><span class="o">.</span><span class="n">id</span><span class="p">;</span>
      <span class="n">name</span>       <span class="o">|</span>      <span class="n">name</span>       <span class="o">|</span> <span class="n">st_distancespheroid</span>
<span class="o">-----------------+-----------------+----------------------</span>
 <span class="n">London</span><span class="p">,</span> <span class="n">Ontario</span> <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">England</span> <span class="o">|</span>     <span class="mf">5892413.63776489</span>
 <span class="n">East</span> <span class="n">London</span><span class="p">,</span><span class="n">SA</span>  <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">England</span> <span class="o">|</span>     <span class="mf">9756842.65711931</span>
 <span class="n">East</span> <span class="n">London</span><span class="p">,</span><span class="n">SA</span>  <span class="o">|</span> <span class="n">London</span><span class="p">,</span> <span class="n">Ontario</span> <span class="o">|</span>     <span class="mf">13884149.4140698</span>
<span class="p">(</span><span class="mi">3</span> <span class="n">rows</span><span class="p">)</span>
</pre></div>
</div>
<p>PostgreSQLコマンドラインを終了するには、次のように入力します。</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>\<span class="n">q</span>
</pre></div>
</div>
<p>システムコンソールに戻ります:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>user@osgeolive:~$
</pre></div>
</div>
</div>
<div class="section" id="mapping">
<h2><a class="toc-backref" href="#id6">マッピング</a><a class="headerlink" href="#mapping" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>PostGISデータからマップを作成するには、データを取得できるクライアントが必要です。QGIS、gvSIG、uDigなど、オープンソースのデスクトップGISプログラムのほとんどがこれを実行できます。では、QGISから地図を作る方法を説明しましょう。</p>
<p>デスクトップGISメニューからQGISを起動し、レイヤメニューから <code class="docutils literal"><span class="pre">PostGISレイヤを追加</span></code> を選択します。PostGISでNatural Earthデータに接続するためのパラメータは、[接続]ドロップダウンメニューで既に定義されています。ここで新しいサーバ接続を定義し、簡単に呼び出せるように設定を保存できます。[接続]ドロップダウンメニューをクリックし、[Natural Earth]を選択します。これらのパラメータがNatural Earthのパラメータであることを確認するには、 <code class="docutils literal"><span class="pre">[編集]</span></code> をクリックします。続行するには、 <code class="docutils literal"><span class="pre">[接続]</span></code> をクリックします。</p>
<a class="reference internal image-reference" href="../../_images/postgis_addlayers.png"><img alt="Connect to Natural Earth" class="align-center" src="../../_images/postgis_addlayers.png" style="width: 706.5px; height: 474.75px;" /></a>
<p>データベース内の空間テーブルのリストが表示されます:</p>
<a class="reference internal image-reference" href="../../_images/postgis_listtables.png"><img alt="Natural Earth Layers" class="align-center" src="../../_images/postgis_listtables.png" style="width: 711.0px; height: 474.75px;" /></a>
<p>ne_10m_lakesテーブルを選択し、一番下にある <code class="docutils literal"><span class="pre">[追加]</span></code> をクリックします(データベース接続パラメータをロードする <code class="docutils literal"><span class="pre">[読み込み]</span></code> をクリックするのではなく)。QGISにロードする必要があります。</p>
<a class="reference internal image-reference" href="../../_images/postgis_lakesmap.png"><img alt="My First PostGIS layer" class="align-center" src="../../_images/postgis_lakesmap.png" style="width: 1029.0px; height: 605.25px;" /></a>
<p>これで湖の地図が表示されます。QGISはそれらが湖であることを知らないので、あなたのためにそれらを青にしないかもしれません - QGISドキュメントを参照して、これを変更する方法を調べてください。カナダの有名な湖のグループを拡大表示します。</p>
</div>
<div class="section" id="importing-spatial-data-into-the-database">
<h2><a class="toc-backref" href="#id7">空間データをデータベースに読み込む</a><a class="headerlink" href="#importing-spatial-data-into-the-database" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>ほとんどのOSGeoデスクトップツールには、他の形式(例 ESRI Shape)から空間データをデータベースに読み込むための機能があります。ここでもQGISを使って説明します</p>
<p>Importing shapefiles to QGIS can be done via the handy QGIS Database Manager. You find the manager in the menu. Go to <code class="docutils literal"><span class="pre">Database</span> <span class="pre">-&gt;</span> <span class="pre">DB</span> <span class="pre">Manager</span></code>.</p>
<p>Postgisアイテムを展開し、次にNaturalEarthアイテムを展開します。その後、Natural Earthデータベースに接続します。パスワードを確認するメッセージが表示されたら、空白のままにします。パブリックアイテムには、データベースによって提供されるレイヤのリストがあります。メインマネージャウィンドウが表示されます。左側では、データベースからテーブルを選択し、右側のタブを使用してテーブルについて調べることができます。[プレビュー]タブに小さなマップが表示されます。</p>
<a class="reference internal image-reference" href="../../_images/postgis_managerpreview.png"><img alt="QGIS Manager Preview" class="align-center" src="../../_images/postgis_managerpreview.png" style="width: 1026.0px; height: 603.75px;" /></a>
<p>次に、DBマネージャを使用して、シェープファイルをデータベースにインポートします。ここでは、R Statistics Packageアドオンの1つに含まれているNorth Carolina Sudden Infant Death Syndrome(SIDS)データを使用します。</p>
<p>From the <code class="docutils literal"><span class="pre">Table</span></code> menu choose the <code class="docutils literal"><span class="pre">Import</span> <span class="pre">layer/file</span></code> option.
Hit the <code class="docutils literal"><span class="pre">...</span></code> button and browse to the <code class="docutils literal"><span class="pre">sids.shp</span></code> shapefile in the R directory.
(located in /home/user/data/vector/R/shapes):</p>
<a class="reference internal image-reference" href="../../_images/postgis_browsedata.png"><img alt="Find the shapefile" class="align-center" src="../../_images/postgis_browsedata.png" style="width: 632.25px; height: 492.0px;" /></a>
<p>他のものはすべてそのままにして、 <code class="docutils literal"><span class="pre">Load</span></code> を押します。</p>
<a class="reference internal image-reference" href="../../_images/postgis_importsids.png"><img alt="Import a shapefile" class="align-center" src="../../_images/postgis_importsids.png" style="width: 346.5px; height: 400.5px;" /></a>
<p>Let the Coordinate Reference System Selector default to (WGS 84 EPSG:4326) and hit <code class="docutils literal"><span class="pre">OK</span></code>. The shapefile should be imported into PostGIS with no errors. Close the DB Manager and
get back to the main QGIS window.</p>
<p>次に、』PostGISマップを追加’オプションを使用して、SIDSデータをレイヤにロードします。レイヤの再配置と若干の色付けを行うことで、North Carolinaの乳幼児突然死症候群の発生数 (sid74またはsid79フィールド)の階級区分図を作成できるようになります。</p>
<a class="reference internal image-reference" href="../../_images/postgis_sidsmap.png"><img alt="SIDS data mapped" class="align-center" src="../../_images/postgis_sidsmap.png" style="width: 1036.5px; height: 607.5px;" /></a>
</div>
<div class="section" id="get-to-know-pgadmin">
<h2><a class="toc-backref" href="#id8">Get to know pgAdmin</a><a class="headerlink" href="#get-to-know-pgadmin" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>You can use the graphical database client <code class="docutils literal"><span class="pre">pgAdmin</span></code> from the Databases menu to query and modify your database non-spatially. This is the official client for PostgreSQL.</p>
<p>pgAdmin lets you use SQL to manipulate your data tables. You can find and launch pgAdmin
from the Databases folder, existing on the OSGeoLive Desktop.</p>
<a class="reference internal image-reference" href="../../_images/postgis_pgadmin_main_window.png"><img alt="pgAdmin" class="align-center" src="../../_images/postgis_pgadmin_main_window.png" style="width: 579.5px; height: 423.5px;" /></a>
<p>Enter the master password  <code class="docutils literal"><span class="pre">user</span></code>.</p>
<p>Here, you have the option of creating a new connection to a PostgreSQL server, or connecting to an existing server.
In this case, we are going to connect to the predefined <code class="docutils literal"><span class="pre">localhost</span></code> server.</p>
<p>接続が確立されると、システムにすでに存在するデータベースの一覧が表示されます。</p>
<a class="reference internal image-reference" href="../../_images/postgis_adminscreen0.png"><img alt="pgAdmin" class="align-center" src="../../_images/postgis_adminscreen0.png" style="width: 871.5px; height: 639.0px;" /></a>
<p>ほとんどのデータベースのイメージ上の赤い」X」は、まだどのデータベースにも接続していないことを示しています(あなたはデフォルトの <code class="docutils literal"><span class="pre">postgres</span></code> データベースにのみ接続しています)。この時点では、システム上の既存のデータベースしか表示できません。データベースの名前をダブルクリックすることで接続できます。Natural_earth2データベースで実行します。</p>
<p>You can see now that the red X disappeared and a 「&gt;」 appeared on the left. By pressing it a tree is going to appear,
displaying the contents of the database.</p>
<p><code class="docutils literal"><span class="pre">schemas</span></code> サブツリーに移動して展開します。その後、 <code class="docutils literal"><span class="pre">public</span></code> スキーマを展開します。 <code class="docutils literal"><span class="pre">Tables</span></code> を移動して展開すると、このスキーマに含まれるすべてのテーブルを表示できます。</p>
<a class="reference internal image-reference" href="../../_images/postgis_adminscreen1.png"><img alt="pgAdmin" class="align-center" src="../../_images/postgis_adminscreen1.png" style="width: 872.25px; height: 638.25px;" /></a>
</div>
<div class="section" id="executing-a-sql-query-from-pgadmin">
<h2><a class="toc-backref" href="#id9">Executing a SQL query from pgAdmin</a><a class="headerlink" href="#executing-a-sql-query-from-pgadmin" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>pgAdmin, offers the capability of executing queries to a relational database.</p>
<p>To perform a query on the database, you have to press the <code class="docutils literal"><span class="pre">Query</span> <span class="pre">Tool</span></code> button from the main toolbar (the one at the left with the database symbol).</p>
<p>各都市の1974年の乳幼児突然死症候群の発生率を求めます。さらに、計算されたレートに基づいて結果を並べ替えます。そのためには、次のクエリを実行する必要があります(SQLウィンドウのテキストエディタで送信)。</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">select</span> <span class="n">name</span><span class="p">,</span> <span class="mi">1000</span><span class="o">*</span><span class="n">sid74</span><span class="o">/</span><span class="n">bir74</span> <span class="k">as</span> <span class="n">rate</span> <span class="kn">from</span> <span class="nn">sids</span> <span class="n">order</span> <span class="n">by</span> <span class="n">rate</span><span class="p">;</span>
</pre></div>
</div>
<p>Afterwards, you should press the arrow button, pointing to the right (Execute).</p>
<a class="reference internal image-reference" href="../../_images/postgis_adminscreen2.png"><img alt="pgAdmin" class="align-center" src="../../_images/postgis_adminscreen2.png" style="width: 870.75px; height: 636.75px;" /></a>
</div>
<div class="section" id="get-to-know-foreign-data-wrappers-fdw">
<h2><a class="toc-backref" href="#id10">外部データラッパー(FDW)について知る</a><a class="headerlink" href="#get-to-know-foreign-data-wrappers-fdw" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>データベースから、他のPostgreSQLデータベースからテーブルなどのリモートオブジェクトにアクセスしたり、Oracle、MySQL、MS SQL、CouchDBなどのリモートデータベースに接続したりできます。ODBC経由で接続したり、CSVや地理空間データに接続したり、Twitterに接続することもできます。</p>
<p>異なるFDWの一覧は次の場所にあります。</p>
<blockquote>
<div><a class="reference external" href="https://wiki.postgresql.org/wiki/Foreign_data_wrappers">https://wiki.postgresql.org/wiki/Foreign_data_wrappers</a></div></blockquote>
<p>動作の仕組みを見てみましょう。異なるPostgreSQLデータベースに接続するのが一番簡単でしょう。</p>
<p>次の手順に従います。</p>
<p>最初に、使用する外部データラッパーの拡張機能をロードします。異なるPostgreSQLデータベースへの接続には、 <code class="docutils literal"><span class="pre">postgres_fdw</span></code> が必要です。</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">EXTENSION</span> <span class="n">postgres_fdw</span><span class="p">;</span>
</pre></div>
</div>
<p>接続するデータソースの場所を通知する外部サーバーを作成</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">SERVER</span> <span class="n">fdw_pg_server_osm_local</span>
 <span class="n">FOREIGN</span> <span class="n">DATA</span> <span class="n">WRAPPER</span> <span class="n">postgres_fdw</span>
 <span class="n">OPTIONS</span> <span class="p">(</span><span class="n">host</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="n">port</span> <span class="s1">&#39;5432&#39;</span><span class="p">,</span> <span class="n">dbname</span> <span class="s1">&#39;osm_local&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>外部サーバーに接続するときに使用するユーザーを定義</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">USER</span> <span class="n">MAPPING</span> <span class="n">FOR</span> <span class="n">user</span>
      <span class="n">SERVER</span> <span class="n">fdw_pg_server_osm_local</span>
      <span class="n">OPTIONS</span> <span class="p">(</span><span class="n">user</span> <span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="n">password</span> <span class="s1">&#39;user&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>これで、外部テーブルを作成できます。</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">IMPORT</span> <span class="n">FOREIGN</span> <span class="n">SCHEMA</span> <span class="n">public</span>
  <span class="n">LIMIT</span> <span class="n">TO</span> <span class="p">(</span><span class="n">planet_osm_polygon</span><span class="p">,</span> <span class="n">planet_osm_point</span><span class="p">)</span> <span class="o">--</span> <span class="ow">or</span> <span class="n">EXCEPT</span>
  <span class="n">FROM</span> <span class="n">SERVER</span> <span class="n">fdw_pg_server_osm_local</span>
  <span class="n">INTO</span> <span class="n">public</span><span class="p">;</span>
</pre></div>
</div>
<p>データベース内の新しいテーブルを検索し、外部テーブルのデータを参照します。</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Select</span> <span class="o">*</span> <span class="kn">from</span> <span class="nn">planet_osm_polygon</span> <span class="n">limit</span> <span class="mi">10</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="connect-to-a-remote-ogr-data-source-via-ogr-fdw">
<h2><a class="toc-backref" href="#id11">ogr_fdw経由でリモートOGRデータソースに接続</a><a class="headerlink" href="#connect-to-a-remote-ogr-data-source-via-ogr-fdw" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>拡張 <code class="docutils literal"><span class="pre">ogr_fdw</span></code> は、KML、GeoPackage、WFS、GeoJSON、GPX、GMLなどのいくつかの地理データフォーマットの接続を可能にします。</p>
<p>Read more about <code class="docutils literal"><span class="pre">ogr_fdw</span></code>:</p>
<ul class="simple">
<li>Repository: <a class="reference external" href="https://github.com/pramsey/pgsql-ogr-fdw">https://github.com/pramsey/pgsql-ogr-fdw</a></li>
<li>New and improved: <a class="reference external" href="http://blog.cleverelephant.ca/2016/04/ogr-fdw-update.html">http://blog.cleverelephant.ca/2016/04/ogr-fdw-update.html</a></li>
</ul>
<p class="rubric">拡張機能 <code class="docutils literal"><span class="pre">ogr_fdw</span></code> をデータベースにインストールします。</p>
<p>データベースプロンプトで、次のように入力します。</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">EXTENSION</span> <span class="n">ogr_fdw</span><span class="p">;</span>
</pre></div>
</div>
<p class="rubric">サポートされているフォーマットを確認:</p>
<p>端末を開き、ogr_fdw_infoを検索します:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">locate</span> <span class="n">ogr_fdw_info</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">postgresql</span><span class="o">/</span><span class="mi">10</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">ogr_fdw_info</span> <span class="o">-</span><span class="n">f</span>
</pre></div>
</div>
<p>結果は次のようになります:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Supported</span> <span class="n">Formats</span><span class="p">:</span>
 <span class="o">-&gt;</span> <span class="s2">&quot;OGR_GRASS&quot;</span> <span class="p">(</span><span class="n">readonly</span><span class="p">)</span>
 <span class="o">-&gt;</span> <span class="s2">&quot;PCIDSK&quot;</span> <span class="p">(</span><span class="n">read</span><span class="o">/</span><span class="n">write</span><span class="p">)</span>
 <span class="o">-&gt;</span> <span class="s2">&quot;netCDF&quot;</span> <span class="p">(</span><span class="n">read</span><span class="o">/</span><span class="n">write</span><span class="p">)</span>
 <span class="o">-&gt;</span> <span class="s2">&quot;JP2OpenJPEG&quot;</span> <span class="p">(</span><span class="n">readonly</span><span class="p">)</span>
 <span class="o">-&gt;</span> <span class="s2">&quot;PDF&quot;</span> <span class="p">(</span><span class="n">read</span><span class="o">/</span><span class="n">write</span><span class="p">)</span>
 <span class="o">-&gt;</span> <span class="s2">&quot;MBTiles&quot;</span> <span class="p">(</span><span class="n">read</span><span class="o">/</span><span class="n">write</span><span class="p">)</span>
 <span class="o">-&gt;</span> <span class="s2">&quot;EEDA&quot;</span> <span class="p">(</span><span class="n">readonly</span><span class="p">)</span>
 <span class="o">-&gt;</span> <span class="s2">&quot;ESRI Shapefile&quot;</span> <span class="p">(</span><span class="n">read</span><span class="o">/</span><span class="n">write</span><span class="p">)</span>
 <span class="o">-&gt;</span> <span class="s2">&quot;MapInfo File&quot;</span> <span class="p">(</span><span class="n">read</span><span class="o">/</span><span class="n">write</span><span class="p">)</span>
 <span class="o">....</span> <span class="n">many</span> <span class="n">more</span>
</pre></div>
</div>
<p class="rubric">WFSへのFDWの作成</p>
<p>Geoserverの起動 <span class="menuselection">Geospatial ‣ Web Services ‣ GeoServer ‣ Start GeoServer</span></p>
<ul class="simple">
<li>GeoServerを開く <a class="reference external" href="http://localhost:8082/geoserver/web/">http://localhost:8082/geoserver/web/</a></li>
<li>GeoServer WFS GetCapabilities <a class="reference external" href="http://localhost:8082/geoserver/ows?service=wfs&amp;version=2.0.0&amp;request=GetCapabilities">http://localhost:8082/geoserver/ows?service=wfs&amp;version=2.0.0&amp;request=GetCapabilities</a></li>
<li>GeoServer WFS DescribeFeatureType for topp:states
<a class="reference external" href="http://localhost:8082/geoserver/ows?service=wfs&amp;version=2.0.0&amp;request=DescribeFeatureType&amp;typename=topp:states">http://localhost:8082/geoserver/ows?service=wfs&amp;version=2.0.0&amp;request=DescribeFeatureType&amp;typename=topp:states</a></li>
<li>GeoServer WFS GetFeature topp:states
<a class="reference external" href="http://localhost:8082/geoserver/ows?service=wfs&amp;version=2.0.0&amp;request=GetFeature&amp;typename=topp:states">http://localhost:8082/geoserver/ows?service=wfs&amp;version=2.0.0&amp;request=GetFeature&amp;typename=topp:states</a></li>
</ul>
<p class="rubric">接続するWFSを参照する外部サーバーを作成する</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">CREATE</span> <span class="n">SERVER</span> <span class="n">fdw_ogr_server_wfs</span>
<span class="n">FOREIGN</span> <span class="n">DATA</span> <span class="n">WRAPPER</span> <span class="n">ogr_fdw</span>
<span class="n">OPTIONS</span> <span class="p">(</span> <span class="n">datasource</span> <span class="s1">&#39;WFS:http://localhost:8082/geoserver/ows&#39;</span><span class="p">,</span> <span class="nb">format</span> <span class="s1">&#39;WFS&#39;</span> <span class="p">);</span>
</pre></div>
</div>
<p class="rubric">1つのコマンドで、すべてのWFS地物_タイプを外部テーブルとしてインポートします。</p>
<p>インポート後、スキーマに新しい外部テーブルがいくつか表示されます。</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">IMPORT</span> <span class="n">FOREIGN</span> <span class="n">SCHEMA</span> <span class="n">ogr_all</span>
<span class="n">FROM</span> <span class="n">SERVER</span> <span class="n">fdw_ogr_server_wfs</span>
   <span class="n">INTO</span> <span class="n">public</span><span class="p">;</span>
</pre></div>
</div>
<p class="rubric">外部データテーブルを確認 <code class="docutils literal"><span class="pre">topp_states</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">topp_states</span> <span class="n">WHERE</span> <span class="n">state_name</span> <span class="o">=</span> <span class="s1">&#39;Minnesota&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="things-to-try">
<h2><a class="toc-backref" href="#id12">試してみること</a><a class="headerlink" href="#things-to-try" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>次に、試すべき追加の課題をいくつか示します。</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">st_buffer(geom)</span></code>, <code class="docutils literal"><span class="pre">st_transform(geom,25831)</span></code>, <code class="docutils literal"><span class="pre">st_x(geom)</span></code> - のようないくつかの空間関数を試してください。完全なドキュメントは <a class="reference external" href="http://postgis.net/documentation/">http://postgis.net/documentation/</a></li>
<li>コマンドラインで <code class="docutils literal"><span class="pre">pgsql2shp</span></code> を使用して、テーブルをシェープファイルにエクスポートします。</li>
<li>データベースにデータをインポート/エクスポートするには、コマンドラインで <code class="docutils literal"><span class="pre">ogr2ogr</span></code> を試してください。</li>
<li>コマンドラインで <code class="docutils literal"><span class="pre">shp2pgsql</span></code> を使用して、データベースにデータをインポートしてみてください。</li>
<li>Try to do road routing using <a class="reference internal" href="../overview/pgrouting_overview.html"><span class="doc">pgRouting</span></a>.</li>
</ul>
</div>
<div class="section" id="what-next">
<h2><a class="toc-backref" href="#id13">次のステップ</a><a class="headerlink" href="#what-next" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>これは、PostGISを使用するための最初のステップです。他にも多くの機能を試すことができます。</p>
<ul class="simple">
<li>PostGISプロジェクトホーム -  <a class="reference external" href="http://postgis.net">http://postgis.net</a></li>
<li>PostGISドキュメント -  <a class="reference external" href="http://postgis.net/documentation/">http://postgis.net/documentation/</a></li>
</ul>
</div>
</div>


          </div>
      </div>
      <div class="clearer"></div>
    </div>
    
    <div class="related">
	<font size="-2">
		<div id="translations">
		<!-- alphabetical order -->
              <a href="javascript:defaultRedirect('en')">English</a> |   <a href="javascript:defaultRedirect('de')">Deutsch</a> |   <a href="javascript:defaultRedirect('es')">Español</a> |   <a href="javascript:defaultRedirect('fi')">Suomen kieli</a> |   <a href="javascript:defaultRedirect('fr')">Français</a> |   <a href="javascript:defaultRedirect('it')">Italiano</a> |   <a href="javascript:defaultRedirect('ja')">日本語</a> |   <a href="javascript:defaultRedirect('hu')">Hungarian</a>
		</div>
	</font>
    </div>



        
        
<span style="font-size:85%;"><i><a href="../copyright.html">Copyright & Disclaimer</a></i></span>
        


  </body>
</html>