
<!DOCTYPE html>

<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>R クイック スタート &#8212; OSGeoLive 15.0 Documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/overview.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/../_themes/overview/static/overview.css" />
    <script data-url_root="../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/translations.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="検索" href="../search.html" />
    <link rel="copyright" title="著作権" href="../copyright.html" />
    <link rel="next" title="XyGrib" href="../overview/xygrib_overview.html" />
    <link rel="prev" title="R" href="../overview/R_overview.html" />
	<script type="text/javascript" src="../../_static/osgeolive.js"></script>


  </head><body>

        
        
    <div class="header">
	<div class="banner"><a href="http://live.osgeo.org/"><img src="../../_images/osgeolive-banner.png"></a></div>
        <div class="nowrap">
            <ul id="top-nav">
              <li><a href="../index.html">Home</a></li>
              <li><a href="../overview/overview.html">Contents</a></li>
              <li><a href="../download.html">Download</a></li>
              <li><a href="../metrics.html">Metrics</a></li>
              <li><a href="../sponsors.html">Sponsors</a></li>
              <li><a href="../contact.html">Contact Us</a></li>
            </ul>
        </div>
    </div>
    </div>
        


    
    <div class="related">
	<font size="-2">
		<div id="translations">
		<!-- alphabetical order -->
              <a href="javascript:defaultRedirect('en')">English</a> |   <a href="javascript:defaultRedirect('de')">Deutsch</a> |   <a href="javascript:defaultRedirect('es')">Español</a> |   <a href="javascript:defaultRedirect('fi')">Suomen kieli</a> |   <a href="javascript:defaultRedirect('fr')">Français</a> |   <a href="javascript:defaultRedirect('hu')">Hungarian</a> |   <a href="javascript:defaultRedirect('it')">Italiano</a> |   <a href="javascript:defaultRedirect('ja')">日本語</a>
		</div>
	</font>
    </div>

  

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <a class="reference external image-reference" href="https://cran.r-project.org"><img alt="../../_images/logo_R.png" class="align-right" src="../../_images/logo_R.png" /></a>
<section id="r-quickstart">
<h1>R クイック スタート<a class="headerlink" href="#r-quickstart" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>Rは、統計計算とグラフィックスのためのフリーソフトウェア環境です。</p>
<p>このクイックスタートでは、次の方法について説明します:</p>
<blockquote>
<div><ul class="simple">
<li><p>簡単な算術演算に R を使用する</p></li>
<li><p>シェープファイルからデータを読み込み、地図化する</p></li>
<li><p>座標変換を行う</p></li>
<li><p>地図上にいくつかのデータポイントをプロットする</p></li>
</ul>
</div></blockquote>
<div class="contents local topic" id="contents">
<p class="topic-title">目次</p>
<ul class="simple">
<li><p><a class="reference internal" href="#start-r" id="id1">R の起動</a></p></li>
<li><p><a class="reference internal" href="#building-data" id="id2">データの構築</a></p></li>
<li><p><a class="reference internal" href="#loading-map-data" id="id3">マップ データの読み込み</a></p></li>
<li><p><a class="reference internal" href="#vignettes" id="id4">ビネット(短かい解説)</a></p></li>
<li><p><a class="reference internal" href="#what-next" id="id5">次のステップ</a></p></li>
</ul>
</div>
<section id="start-r">
<h2><a class="toc-backref" href="#id1">R の起動</a><a class="headerlink" href="#start-r" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>R は基本的にコマンドラインプログラムですが、GUI も利用できます。プロンプトで1行のコードを入力し、return キーを押すと、R インタプリタがそれを評価して結果を出力します。</p>
<div class="admonition tip">
<p class="admonition-title">ちなみに</p>
<p>コマンドラインはそんなに怖いものではなく、とても便利なものです。ミスタイプをしても十字キーの上下でコマンド履歴を呼び出し編集することができます。表示が止まってしまった場合は CTRL-C を入力することで復帰することができます。</p>
</div>
<p><span class="menuselection">Geospatial ‣ Spatial Tools ‣ R Statistics</span> を選択します。ターミナルウィンドウが開き、R が実行されます。</p>
<p>簡単な算術演算から始めることができます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="mi">3</span><span class="o">*</span><span class="mi">2</span>
<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="mi">6</span>

<span class="o">&gt;</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">4</span>
<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="mf">2.5</span>

<span class="o">&gt;</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="mf">1.414214</span>

<span class="o">&gt;</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="mf">1.155727</span>
</pre></div>
</div>
<p>算術関数、三角関数、統計関数のすべてが組み込まれており、 <a class="reference external" href="https://cran.r-project.org/">CRAN</a> アーカイブのパッケージからさらに数千が利用可能です。</p>
<p>Rのメインプロンプトは  <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> ですが、継続プロンプト <code class="docutils literal notranslate"><span class="pre">+</span></code> もあります。これは、Rが有効な式を作るためにさらに多くの入力を期待する場合に表示されます。閉じ括弧や閉じ括弧を忘れた場合に表示されます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">sqrt</span><span class="p">(</span>
<span class="o">+</span> <span class="mi">2</span>
<span class="o">+</span> <span class="p">)</span>
<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="mf">1.414214</span>
</pre></div>
</div>
</section>
<section id="building-data">
<h2><a class="toc-backref" href="#id2">データの構築</a><a class="headerlink" href="#building-data" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>出力の中で、角括弧に囲まれた謎の'one'が何をしているのか、不思議に思っているかもしれません。これは、結果が1つの数値であることを示しています。Rは、1次元のベクタ、2次元の行列、多次元の配列ます。これらを生成する関数はたくさんあります。以下に簡単なシーケンスを示します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">seq</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="nb">len</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="mf">1.000000</span> <span class="mf">1.444444</span> <span class="mf">1.888889</span> <span class="mf">2.333333</span> <span class="mf">2.777778</span> <span class="mf">3.222222</span> <span class="mf">3.666667</span> <span class="mf">4.111111</span>
<span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="mf">4.555556</span> <span class="mf">5.000000</span>
</pre></div>
</div>
<p>これで、 <code class="docutils literal notranslate"><span class="pre">[9]</span></code> によって、4.555が9番目の値であることがわかります。</p>
<p>行列を作成すると、行と列のラベルが作成されます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">m</span>
     <span class="p">[,</span><span class="mi">1</span><span class="p">]</span> <span class="p">[,</span><span class="mi">2</span><span class="p">]</span> <span class="p">[,</span><span class="mi">3</span><span class="p">]</span> <span class="p">[,</span><span class="mi">4</span><span class="p">]</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,]</span>    <span class="mi">1</span>    <span class="mi">4</span>    <span class="mi">7</span>   <span class="mi">10</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,]</span>    <span class="mi">2</span>    <span class="mi">5</span>    <span class="mi">8</span>   <span class="mi">11</span>
<span class="p">[</span><span class="mi">3</span><span class="p">,]</span>    <span class="mi">3</span>    <span class="mi">6</span>    <span class="mi">9</span>   <span class="mi">12</span>
</pre></div>
</div>
<p>行列の要素は、カンマで区切られた行と列のインデックスを持つ角括弧を使用して抽出できます。ベクタとして行全体を取得するには、インデックスを空白のままにします。ベクタインデックスを使用して、複数の行や列を小さな行列として取得します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>
<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="mi">11</span>

<span class="o">&gt;</span> <span class="n">m</span><span class="p">[</span><span class="mi">2</span><span class="p">,]</span>
<span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="mi">2</span>  <span class="mi">5</span>  <span class="mi">8</span> <span class="mi">11</span>

<span class="o">&gt;</span> <span class="n">m</span><span class="p">[,</span><span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
     <span class="p">[,</span><span class="mi">1</span><span class="p">]</span> <span class="p">[,</span><span class="mi">2</span><span class="p">]</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,]</span>    <span class="mi">7</span>   <span class="mi">10</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,]</span>    <span class="mi">8</span>   <span class="mi">11</span>
<span class="p">[</span><span class="mi">3</span><span class="p">,]</span>    <span class="mi">9</span>   <span class="mi">12</span>
</pre></div>
</div>
<p>データフレームは、PostgresやMySQLなどのRDBMSにあるような構造を反映したデータ構造です。各行はレコードとみなすことができ、カラムはデータベースのフィールドのようなものです。データベースと同様に、各フィールドは各レコードで同じ型でなければなりません。</p>
<p>これらは多くの点で行列のように機能しますが、$-表記法を使用して名前でカラムを取得・設定することもできます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&gt; d = data.frame(x=1:10, y=1:10, z=runif(10)) # z is 10 random numbers
&gt; d
        x  y          z
    1   1  1 0.44128080
    2   2  2 0.09394331
    3   3  3 0.51097462
    4   4  4 0.82683828
    5   5  5 0.21826740
    6   6  6 0.65600533
    7   7  7 0.59798278
    8   8  8 0.19003625
    9   9  9 0.24004866
    10 10 10 0.35972749

&gt; d$z
 [1] 0.44128080 0.09394331 0.51097462 0.82683828 0.21826740 0.65600533
 [7] 0.59798278 0.19003625 0.24004866 0.35972749

&gt; d$big = d$z &gt; 0.6  # d$big is now a boolean true/false value
&gt; d[1:5,]
  x y          z   big
1 1 1 0.44128080 FALSE
2 2 2 0.09394331 FALSE
3 3 3 0.51097462 FALSE
4 4 4 0.82683828  TRUE
5 5 5 0.21826740 FALSE

&gt; d$name = letters[1:10] # create a new field of characters
&gt; d[1:5,]
  x y          z   big name
  1 1 1 0.44128080 FALSE    a
  2 2 2 0.09394331 FALSE    b
  3 3 3 0.51097462 FALSE    c
  4 4 4 0.82683828  TRUE    d
  5 5 5 0.21826740 FALSE    e
</pre></div>
</div>
</section>
<section id="loading-map-data">
<h2><a class="toc-backref" href="#id3">マップ データの読み込み</a><a class="headerlink" href="#loading-map-data" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>空間データ操作と統計のための多くのパッケージがあります。ここに含まれているものもあれば、CRANからダウンロードできるものもあります。</p>
<p>ここでは、2つのシェープファイル、つまりNatural Earthデータから国の境界と居住地を読み込みます。空間機能を利用するために、2つのアドオンパッケージを使用します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">library</span><span class="p">(</span><span class="n">sf</span><span class="p">)</span>           <span class="c1"># Simple Features manipulation Library</span>
<span class="o">&gt;</span> <span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>      <span class="c1"># Plotting library</span>

<span class="o">&gt;</span> <span class="n">countries</span> <span class="o">&lt;-</span> <span class="n">st_read</span><span class="p">(</span><span class="n">dsn</span> <span class="o">=</span> <span class="s2">&quot;~/data/natural_earth2/ne_10m_admin_0_countries.shp&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">places</span> <span class="o">&lt;-</span> <span class="n">st_read</span><span class="p">(</span><span class="n">dsn</span> <span class="o">=</span> <span class="s2">&quot;~/data/natural_earth2/ne_10m_populated_places.shp&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">ggplot</span><span class="p">(</span><span class="n">countries</span><span class="p">)</span> <span class="o">+</span> <span class="n">geom_sf</span><span class="p">()</span>
</pre></div>
</div>
<p>これは私たちに世界の簡単な地図を与えます:</p>
<img alt="../../_images/r_plot1.png" src="../../_images/r_plot1.png" />
<p>このデータセットでOGRウェイがRに読み込まれると、データフレームのように多くの方法で動作するオブジェクトが返されます。<code class="docutils literal notranslate"><span class="pre">admin</span></code> フィールドを使用して、世界のデータをサブセット化し、英国を取得することができます。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&gt; uk &lt;- countries[countries$admin == &#39;United Kingdom&#39;,]
&gt; ggplot(uk) + geom_sf()
</pre></div>
</div>
<img alt="../../_images/r_plot2.png" src="../../_images/r_plot2.png" />
<p>緯度を中心とした座標系に慣れているので、ここに住んでいる人には少々押しつぶされたように見えます。現在、オブジェクトには座標系が割り当てられていません。</p>
<p>sfパッケージからsf::st_transform関数を使用してオブジェクトを変換する前に、CRSを割り当てる必要があります。英国Ordnance SurveyのグリッドシステムであるEPSG:27700に変換します。</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">ukos</span> <span class="o">&lt;-</span> <span class="n">st_transform</span><span class="p">(</span><span class="n">uk</span><span class="p">,</span><span class="mi">27700</span><span class="p">)</span>
<span class="o">&gt;</span> <span class="n">ggplot</span><span class="p">(</span><span class="n">ukos</span><span class="p">)</span> <span class="o">+</span> <span class="n">geom_sf</span><span class="p">()</span>
</pre></div>
</div>
<img alt="../../_images/r_plot2_1.png" src="../../_images/r_plot2_1.png" />
<p>これは、変換されたデータのベースマップをプロットします。次に、設定された場所のデータセットからいくつかの点を追加します。ここでも、目的の点をサブセット化し、Ordnance Surveyグリッド・リファレンス座標に変換します:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&gt; ukpop &lt;- places[places$SOV0NAME == &#39;United Kingdom&#39;,]
&gt; ukpop &lt;- st_transform(ukpop,27700)
</pre></div>
</div>
<p>これらの点をベースマップに追加し、（人口に比例する大きさになるように）人口の平方根の比率でシンボルをサイズ変更します、色を赤に設定し、プロットする文字を塗りつぶした丸印に設定します:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&gt; ggplot() +
&gt;   geom_sf(data = ukos) +                                                          # add UK shape to the map
&gt;   geom_sf(data = ukpop,                                                           # add the Populated places
&gt;           aes(size = ukpop$POP_MAX/100000),                       # fix size of points (by area)
&gt;           colour = &#39;red&#39;, alpha = 1/5) +                          # set points colour and transparency
&gt;   coord_sf(crs = 27700, datum= sf::st_crs(27700),         # set a bounding box
&gt;            xlim = st_bbox(ukos[c(1,3)]),                          # for the map
&gt;            ylim = st_bbox(ukos[c(2,4)])
&gt;           ) +
&gt;   ggtitle(&#39;Uk Population centre sizes&#39;) +                         # set the map title
&gt;       theme(legend.position = &#39;bottom&#39;) +                         # Legend position
&gt;           scale_size_area(name = &#39;Population \nin 100K&#39;)  # 0 value means 0 area + legend title
</pre></div>
</div>
<p>そして最終的な画像が表示されます。</p>
<img alt="../../_images/r_plot3.png" src="../../_images/r_plot3.png" />
<div class="admonition tip">
<p class="admonition-title">ちなみに</p>
<p>Rを終了するには、 <code class="docutils literal notranslate"><span class="pre">q()</span></code> と入力してreturnを押します。作業フォルダをRデータの画像ファイルとして保存するかどうかを尋ねるメッセージが表示されます。<code class="docutils literal notranslate"><span class="pre">.RData</span></code> ファイルがあるディレクトリから再度Rを起動すると、そこからすべてのデータを復元します。</p>
</div>
</section>
<section id="vignettes">
<h2><a class="toc-backref" href="#id4">ビネット(短かい解説)</a><a class="headerlink" href="#vignettes" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>以前は、Rパッケージのドキュメントは、関数ごとに簡潔に書かれたヘルプページになる傾向がありました。パッケージ作成者は、パッケージをわかりやすく紹介するために 'ビネット' を書くことが推奨されています。<code class="docutils literal notranslate"><span class="pre">vignette()</span></code> 関数を引数なしで実行すると、システム内のビネット の一覧を得ることができます。R空間パッケージのより技術的な紹介を見るには、 <code class="docutils literal notranslate"><span class="pre">vignette(&quot;sf1&quot;)</span></code> を試してみてください。</p>
</section>
<section id="what-next">
<h2><a class="toc-backref" href="#id5">次のステップ</a><a class="headerlink" href="#what-next" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>いまは、Rに関する一般的な情報については、公式の <a class="reference external" href="https://cran.r-project.org/doc/manuals/R-intro.html">Introduction to R</a> またはメインの <a class="reference external" href="https://www.r-project.org/">R Project</a> ページにあたるとよいでしょう。</p>
<p>Rの空間的側面の詳細については、おそらく <a class="reference external" href="https://cran.r-project.org/web/views/Spatial.html">R Spatial Task View</a> から始めるのが最適です。</p>
<p><a class="reference external" href="https://www.rspatial.org">R-Spatial</a>  ページもチェックしてみてください。</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
      </div>
      <div class="clearer"></div>
    </div>
    
    <div class="related">
	<font size="-2">
		<div id="translations">
		<!-- alphabetical order -->
              <a href="javascript:defaultRedirect('en')">English</a> |   <a href="javascript:defaultRedirect('de')">Deutsch</a> |   <a href="javascript:defaultRedirect('es')">Español</a> |   <a href="javascript:defaultRedirect('fi')">Suomen kieli</a> |   <a href="javascript:defaultRedirect('fr')">Français</a> |   <a href="javascript:defaultRedirect('hu')">Hungarian</a> |   <a href="javascript:defaultRedirect('it')">Italiano</a> |   <a href="javascript:defaultRedirect('ja')">日本語</a>
		</div>
	</font>
    </div>



        
        
<span style="font-size:85%;"><i><a href="../copyright.html">Copyright & Disclaimer</a></i></span>
        


  </body>
</html>